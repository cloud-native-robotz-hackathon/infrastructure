---

- name: Create ODF Namespace
  kubernetes.core.k8s:
    state: present
    kubeconfig: "{{ k8s_kubeconfig }}"
    definition:
      apiVersion: project.openshift.io/v1
      kind: Project
      metadata:
        name: openshift-storage
      spec: 

- name: Install ODF Operator Subscription
  kubernetes.core.k8s:
    state: present
    kubeconfig: "{{ k8s_kubeconfig }}"
    definition:
      apiVersion: operators.coreos.com/v1alpha1
      kind: Subscription
      metadata:
        name: odf-operator
        namespace: openshift-storage
      spec:
        channel: stable-4.10
        installPlanApproval: Automatic
        name: odf-operator
        source: redhat-operators
        sourceNamespace: openshift-marketplace
        startingCSV: odf-operator.v4.10.7

- name: Include ODF CustomResource instances
  include_tasks: "custom-resource-instances.yml"